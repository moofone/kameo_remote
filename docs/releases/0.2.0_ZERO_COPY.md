# Zero-Copy Cleanup (0.2.0)

**Release date:** January 26, 2026

## Highlights
- **Unified Peer Discovery:** `PeerDiscovery` dropped the legacy `connected_peers`, `pending_peers`, and `failed_peers` collections. All metrics and helper methods now read directly from `peer_states`, which keeps registry stats and dashboard counters in sync.
- **Zero-copy Connection APIs:** `ConnectionHandle::ask_batch`, `ask_batch_with_timeout`, `ask_batch_optimized`, `ask_with_reply_to`, `send_binary_message`, and the streaming helpers now require owned `Bytes`. Callers no longer rely on hidden copies when sending vectored or streaming payloads.
- **Vectored write guarantees:** A new unit test (`write_vectored_nonblocking_preserves_bytes`) exercises the lock-free stream handle to ensure vectored writes reuse the original `Bytes` backing buffers.
- **Forbidden-copy guard:** `scripts/check_forbidden_copy_patterns.sh` scans critical files for `Bytes::copy_from_slice` / `extend_from_slice` usage and is wired into `scripts/full_validation.sh` to keep CRITICAL_PATH sections copy-free.

## Migration Notes
- Update all batch ask helpers to build `Vec<Bytes>` (or slices of `Bytes`) before calling into the connection pool. Convenience slice-based methods were removed to avoid implicit copying.
- Streaming helpers (`stream_large_message*`, `ask_streaming*`) now take owned `Bytes`. Convert existing `Vec<u8>` payloads with `Bytes::from(vec)` to preserve zero-copy semantics.
- Reply delegation APIs (`ReplyTo::reply`) consume owned `Bytes`. Use `reply_bytes` directly or upgrade existing slices with `Bytes::from` before replying.

## Validation
Run `./scripts/full_validation.sh` to execute the updated guardrails, forbidden-copy checks, allocation baselines, pointer identity proofs, telemetry tests, and coverage gates.
