# Allocation measurements run
Fri 23 Jan 2026 14:36:00 AST

## bytemuck_allocation_tests (baseline)
warning: field `deallocations` is never read
  --> tests/bytemuck_allocation_tests.rs:99:5
   |
97 | struct AllocationMetrics {
   |        ----------------- field in this struct
98 |     allocations: usize,
99 |     deallocations: usize,
   |     ^^^^^^^^^^^^^
   |
   = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: `kameo_remote` (test "bytemuck_allocation_tests") generated 1 warning
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.05s
     Running tests/bytemuck_allocation_tests.rs (target/debug/deps/bytemuck_allocation_tests-a7b60943283e9d5f)

running 10 tests

=== BASELINE: StreamHeader Full Roundtrip ===
Allocations: 1000 (0 bytes) | Time: 255.625Âµs
  Result: 1000 allocations per 1000 roundtrips
  Total bytes allocated: 0

=== BASELINE: Hash Extraction (copy_from_slice) ===
test baseline_full_streamheader_roundtrip_allocations ... ok
Allocations: 0 (0 bytes) | Time: 247.625Âµs
  Result: 0 heap allocations (expected 0 - stack only)

=== BASELINE: Hash Extraction Performance ===
test baseline_hash_extraction_allocations ... ok
Allocations: 0 (0 bytes) | Time: 2.042208ms
  Result: 0 heap allocations per 100,000 calls

=== BASELINE: Header Assembly (copy_from_slice) ===
test baseline_hash_extraction_performance ... ok
Allocations: 0 (0 bytes) | Time: 220.708Âµs
  Result: 0 heap allocations (expected 0 - stack only)

=== BASELINE: PublicKey::from_bytes ===
test baseline_header_assembly_allocations ... ok
Allocations: 0 (0 bytes) | Time: 12.101542ms
  Result: 0 allocations per 1000 calls
  Total bytes allocated: 0

=== BASELINE: NodeId::from_bytes ===
test baseline_key_conversion_allocations ... ok
Allocations: 0 (0 bytes) | Time: 12.427416ms
  Result: 0 allocations per 1000 calls
  Total bytes allocated: 0

=== BASELINE: StreamHeader::to_bytes ===
test baseline_node_id_conversion_allocations ... ok
Allocations: 1000 (0 bytes) | Time: 108.75Âµs
  Result: 1000 allocations per 1000 calls
  Total bytes allocated: 0
  Bytes per call: 0

=== BASELINE: StreamHeader::from_bytes ===
test baseline_streamheader_to_bytes_allocations ... ok
Allocations: 0 (0 bytes) | Time: 138.5Âµs
  Result: 0 allocations per 1000 calls
  Total bytes allocated: 0

=== BASELINE: StreamHeader Various Sizes ===
test baseline_streamheader_from_bytes_allocations ... okAllocations: 100 (0 bytes) | Time: 12.875
Âµs
  Size 64: 100 allocations per 100 calls (0 bytes)
Allocations: 100 (0 bytes) | Time: 11.667Âµs
  Size 256: 100 allocations per 100 calls (0 bytes)
Allocations: 100 (0 bytes) | Time: 12.875Âµs
  Size 1024: 100 allocations per 100 calls (0 bytes)
Allocations: 100 (0 bytes) | Time: 9.333Âµs
  Size 4096: 100 allocations per 100 calls (0 bytes)
Allocations: 100 (0 bytes) | Time: 11.292Âµs
  Size 16384: 100 allocations per 100 calls (0 bytes)
Allocations: 100 (0 bytes) | Time: 11.416Âµs
  Size 65536: 100 allocations per 100 calls (0 bytes)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           BASELINE ALLOCATION SUMMARY REPORT                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. StreamHeader::to_bytes (1000 calls)
test baseline_streamheader_various_sizes_allocations ... ok
Allocations: 1000 (0 bytes) | Time: 103.333Âµs
   â†’ 1000 allocations, 0 bytes (0 bytes/call)

2. StreamHeader::from_bytes (1000 calls)
Allocations: 0 (0 bytes) | Time: 136.583Âµs
   â†’ 0 allocations, 0 bytes

3. Hash extraction (10000 calls)
Allocations: 0 (0 bytes) | Time: 214Âµs
   â†’ 0 heap allocations (stack only)

4. PublicKey::from_bytes (1000 calls)
Allocations: 0 (0 bytes) | Time: 12.289708ms
   â†’ 0 allocations, 0 bytes

5. Header assembly (10000 calls)
Allocations: 0 (0 bytes) | Time: 260.25Âµs
   â†’ 0 heap allocations (stack only)

6. StreamHeader roundtrip (1000 calls)
Allocations: 1000 (0 bytes) | Time: 238.125Âµs
   â†’ 1000 allocations, 0 bytes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BASELINE COMPLETE - DO NOT MODIFY UNTIL OPTIMIZATION PHASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
test baseline_summary_all_tests ... ok

test result: ok. 10 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.04s


## body_allocation_baseline
warning: field `deallocations` is never read
  --> tests/body_allocation_baseline.rs:47:5
   |
45 | struct AllocationMetrics {
   |        ----------------- field in this struct
46 |     allocations: usize,
47 |     deallocations: usize,
   |     ^^^^^^^^^^^^^
   |
   = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: `kameo_remote` (test "body_allocation_baseline") generated 1 warning
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.04s
     Running tests/body_allocation_baseline.rs (target/debug/deps/body_allocation_baseline-5351baead5d5099c)

running 3 tests

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           ZERO-COPY BODY ACCESS SUMMARY        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY FINDING:
  Archived access is zero-copy for RegistryMessage payloads
  â†’ No allocations for message body access

EXPECTED BEHAVIOR:
  rkyv::access::<Archived<RegistryMessage>>() returns &Archived<RegistryMessage>
  â†’ Zero-copy reference into serialized buffer

=== ZERO-COPY: Distributed Actor Messages (remote_tell) ===
Same pattern as above, using archived access

=== ZERO-COPY: RegistryMessage Body Access ===
Current code path: rkyv::access::<Archived<RegistryMessage>>()

test baseline_summary ... ok
Allocations: 0 (0 bytes) | Time: 704.208Âµs
ZERO-COPY (rkyv::access):
  â†’ 0 allocations per 100 archived accesses
  â†’ Total bytes: 0
Allocations: 2 (18446744073709544859 bytes) | Time: test zero_copy_distributed_actor_messages ... 727ok.
583Âµs
ZERO-COPY (rkyv::access):
  â†’ 2 allocations per 100 archived accesses
  â†’ Total bytes: 18446744073709544859
test zero_copy_registry_message_body_allocations ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s


## pooled_send_bench
   Compiling kameo_remote v0.1.0 (/Users/greg/Dev/git/kameo_remote)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.28s
     Running tests/pooled_send_bench.rs (target/debug/deps/pooled_send_bench-90d91d9c5aac9ab4)

running 1 test
ğŸ« [PERMIT] #0 acquiring control permit (available: 32/256)
ğŸ« [PERMIT] #32 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #64 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #96 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #128 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #160 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #192 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #224 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #256 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #288 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #320 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #352 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #384 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #416 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #448 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #480 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #512 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #544 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #576 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #608 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #640 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #672 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #704 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #736 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #768 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #800 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #832 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #864 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #896 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #928 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #960 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #992 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1000 acquiring control permit (available: 24/256)
[tell] size=128B count=1000 throughput=126914 msg/s allocs=129 deallocs=126
[ask] size=128B count=1000 throughput=703689 msg/s allocs=51 deallocs=54
ğŸ« [PERMIT] #1048 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1080 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1112 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1144 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1176 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1208 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1240 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1272 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1304 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1336 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1368 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1400 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1432 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1464 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1496 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1528 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1560 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1592 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1624 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1656 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1688 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1720 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1752 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1784 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1816 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1848 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1880 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1912 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1944 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #1976 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2000 acquiring control permit (available: 8/256)
ğŸ« [PERMIT] #2008 acquiring control permit (available: 0/256)
[tell] size=4096B count=1000 throughput=340228 msg/s allocs=125 deallocs=129
[ask] size=4096B count=1000 throughput=483608 msg/s allocs=50 deallocs=54
ğŸ« [PERMIT] #2064 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2096 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2128 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2160 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2192 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2224 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2256 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2288 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2320 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2352 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2384 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2416 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2448 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2480 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2512 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2544 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2576 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2608 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2640 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2672 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2704 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2736 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2768 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2800 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2832 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2864 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2896 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2928 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2960 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #2992 acquiring control permit (available: 0/256)
ğŸ« [PERMIT] #3000 acquiring control permit (available: 24/256)
ğŸ« [PERMIT] #3024 acquiring control permit (available: 0/256)
[tell] size=65536B count=1000 throughput=138238 msg/s allocs=128 deallocs=132
[ask] size=65536B count=1000 throughput=318530 msg/s allocs=32 deallocs=34
test test_pooled_send_benchmarks ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.03s


## zero_copy_benchmarks
   Compiling kameo_remote v0.1.0 (/Users/greg/Dev/git/kameo_remote)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.18s
     Running tests/zero_copy_benchmarks.rs (target/debug/deps/zero_copy_benchmarks-0311ebd85e3277a2)

running 2 tests
ğŸ“Š Zero-Copy Deserialization Benefit Analysis
========================================

Typical DeltaGossip Message Breakdown:
  RegistryMessage enum: 200 bytes
  RegistryDelta struct: 100 bytes
  Changes Vec: 5000 bytes
  Actor payload: 10240 bytes
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total serialized: ~15540 bytes

Allocations with owned deserialization:
  RegistryMessage: 200 bytes
  RegistryDelta: 100 bytes
  Changes Vec: 5000 bytes
  Payload Vec<u8>: 10240 bytes
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL ALLOCATED: ~15540 bytes

Allocations with rkyv::access (zero-copy):
  RegistryMessage: 0 bytes (reference into buffer)
  RegistryDelta: 0 bytes (reference into buffer)
  Changes: 0 bytes (ArchivedVec references buffer)
  Payload: 0 bytes (ArchivedVec<u8> references buffer)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL ALLOCATED: 0 bytes

ğŸ“‰ Theoretical Allocation Reduction:
  Savings: ~15540 bytes (100%)

test show_zero_copy_theoretical_benefit ... ok
âœ… rkyv::access Benchmark (Zero-Copy):
   Total time: 5.749333ms
   Per operation: 5.75 Î¼s
   Operations/sec: 173943

test benchmark_archived_access ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.01s

